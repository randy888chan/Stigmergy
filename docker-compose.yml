version: '3.8'
services:
  # This is our new development service
  stigmergy-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: stigmergy_dev
    ports:
      - "3010:3010"
    volumes:
      # Mount the entire project directory into the container
      # This enables hot-reloading when you change files locally
      - .:/usr/src/app
      # Use a named volume for node_modules to prevent local modules from overwriting container modules
      - node_modules:/usr/src/app/node_modules
    # Use the development environment file
    env_file:
      - .env.development

  # The existing production services remain unchanged
  stigmergy:
    build: .
    container_name: stigmergy_app
    ports:
      - "3011:3010" # Use a different host port to avoid conflicts with dev
    env_file:
      - .env.production
    depends_on:
      - neo4j

  neo4j:
    image: neo4j:5
    container_name: neo4j_db
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_AUTH=neo4j/your_secure_password
    volumes:
      - neo4j_data:/data

volumes:
  neo4j_data:
  node_modules: # Define the named volume for node_modules