name: Release
    on:
      workflow_dispatch: # This is the only trigger now
        inputs:
          version_type:
            description: 'Version bump type'
            required: true
            default: 'patch'
            type: choice
            options:
              - patch
              - minor
              - major
    permissions:
      contents: write
      issues: write
      pull-requests: write
      packages: write
    jobs:
      release:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v4
            with:
              fetch-depth: 0
              token: ${{ secrets.GITHUB_TOKEN }}
          - name: Setup Node.js
            uses: actions/setup-node@v4
            with:
              node-version: '18'
              cache: npm
              registry-url: 'https://registry.npmjs.org'
          - name: Install dependencies
            run: npm ci
          - name: Run tests and validation
            run: |
              npm run validate
          - name: Semantic Release
            env:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              NPM_TOKEN: ${{ secrets.NPM_TOKEN }} # You would need to set this in repo secrets to publish
              NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
            run: npx semantic-release
