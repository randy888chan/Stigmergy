$ bun test tests/integration/**
bun test v1.2.14 (6a363a38)

tests/integration/workflows/03_execution.test.js:
GraphStateManager: Using pre-configured Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] State changed to: AWAITING_USER_INPUT
[Engine] Triggering agent @dispatcher with prompt: "Proceed with the plan."
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] Triggering agent @executor with prompt: "Create file src/example.js with content: console.log("hello");"
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[Engine] Triggering agent auditor with prompt: "Audit the following action for constitutional compliance:

- Agent: executor
- Tool: file_system.writeFile
- Arguments: {
  "path": "src/example.js",
  "content": "console.log(\"hello\");"
}"
[ConstitutionalAudit] Action approved by @auditor.
[LLM Adapter] File cache cleared
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
[Engine] State changed to: PLAN_EXECUTED
[System Tool] System status successfully updated to PLAN_EXECUTED.
(pass) Execution Workflow: @dispatcher and @executor > Dispatcher should read plan and delegate to executor [23.06ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.

tests/integration/workflows/full_e2e_workflow.test.js:
GraphStateManager: Using pre-configured Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] Triggering agent @specifier with prompt: "Create a plan."
[Engine] Triggering agent @qa with prompt: "Review the plan."
[Engine] Triggering agent @dispatcher with prompt: "The plan is approved. Please write the file."
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[Engine] Triggering agent auditor with prompt: "Audit the following action for constitutional compliance:

- Agent: dispatcher
- Tool: file_system.writeFile
- Arguments: {
  "path": "hello.txt",
  "content": "Hello, world!"
}"
[ConstitutionalAudit] Action approved by @auditor.
[LLM Adapter] File cache cleared
[Engine] State changed to: EXECUTION_COMPLETE
[System Tool] System status successfully updated to EXECUTION_COMPLETE.
(pass) Full E-to-E Workflow (Isolated) > Isolation Test: Manually-triggered workflow should execute correctly [5.63ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.

tests/integration/workflows/research_workflow.test.js:
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] Triggering agent @analyst with prompt: "What is the impact of AI on software development?"
(pass) Research Workflow > triggers deep_dive, evaluate_sources, and reports with confidence [0.79ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.

tests/integration/workflows/planning_and_review.test.js:
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] Triggering agent @specifier with prompt: "Create a plan for a simple file."
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] Triggering agent @qa with prompt: "Please review the generated plan."
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
(pass) Phase-Based E2E Test: Planning and Review Handoff > Specifier should correctly delegate a plan to the QA agent [3.82ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.

tests/integration/workflows/genesis_workflow.test.js:
GraphStateManager: Using pre-configured Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] State changed to: AWAITING_USER_INPUT
[Engine] Triggering agent @genesis with prompt: "Create a new Node.js project with an index.js file that logs 'hello world'"
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[Engine] Triggering agent auditor with prompt: "Audit the following action for constitutional compliance:

- Agent: genesis
- Tool: file_system.writeFile
- Arguments: {
  "path": "index.js",
  "content": "console.log('hello world');"
}"
[ConstitutionalAudit] Action approved by @auditor.
[LLM Adapter] File cache cleared
(pass) Genesis Agent Workflow > should initialize a new project, create a file, and make an initial commit [5.19ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.

tests/integration/engine/agent_and_tools.test.js:
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[TrajectoryRecorder] Neo4j driver is not available. Trajectory graph logging will be disabled.
(pass) Engine: Agent and Coderag Tool Integration > should call coderag.semantic_search [1.37ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[TrajectoryRecorder] Neo4j driver is not available. Trajectory graph logging will be disabled.
(pass) Engine: Agent and Coderag Tool Integration > should call coderag.calculate_metrics [1.03ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[TrajectoryRecorder] Neo4j driver is not available. Trajectory graph logging will be disabled.
(pass) Engine: Agent and Coderag Tool Integration > should call coderag.find_architectural_issues [0.99ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.

tests/integration/engine/tool_executor.test.js:
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[ConstitutionalAudit] Action approved by @auditor.
[LLM Adapter] File cache cleared
(pass) Tool Executor Security (Definitive Fix) > should allow writing to a safe directory [1.82ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[ConstitutionalAudit] Action approved by @auditor.
(pass) Tool Executor Security (Definitive Fix) > should prevent writing to an unsafe directory [1.81ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[ConstitutionalAudit] Action approved by @auditor.
(pass) Tool Executor Security (Definitive Fix) > should prevent path traversal [0.65ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[ConstitutionalAudit] Action approved by @auditor.
(pass) Tool Executor Security (Definitive Fix) > should prevent writing to a generated code path [0.63ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[ConstitutionalAudit] Action approved by @auditor.
[LLM Adapter] File cache cleared
(pass) Tool Executor Security (Definitive Fix) > should allow @guardian to write to core files [1.01ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[ConstitutionalAudit] Action approved by @auditor.
(pass) Tool Executor Security (Definitive Fix) > should prevent non-@guardian agents from writing to core files [0.64ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[ConstitutionalAudit] Invoking @auditor for critical tool: file_system.writeFile
[ConstitutionalAudit] Action blocked by @auditor: Violation of test principle.
(pass) Tool Executor Security (Definitive Fix) > should block a tool call if the @auditor deems it non-compliant [0.94ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.

tests/integration/engine/human_handoff.test.js:
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
serveStatic: root path '/app/dashboard/public' is not found, are you sure it's correct?
[Engine] Triggering agent @dispatcher with prompt: "Please request approval for the plan."
[System Tool] Requesting human approval (ID: req_1762024525318_ckd6q86): Approve plan?
(pass) Human Handoff Workflow > Dispatcher agent should call the request_human_approval tool [102.34ms]
[Engine] Shutting down... (Server running: false, External StateManager: true)
[Engine] OpenTelemetry SDK shut down.
[Engine] Shutdown complete.
GraphStateManager: Closing Neo4j driver.

tests/integration/external/ai_provider.test.js:
(skip) External Service Health Check: AI Provider > LIVE: should connect to OpenRouter and receive a valid model list

tests/integration/external/database.test.js:
(skip) External Service Health Check: Neo4j Database > LIVE: should connect to the configured Neo4j database successfully

 16 pass
 2 skip
 0 fail
 34 expect() calls
Ran 18 tests across 10 files. [964.00ms]
